Описание модели
===============

Данная модель представляет пространство в виде трёх типов элементов: клетка,
сайт и атом. Расчёт энергии ведётся только с учётом ближайших соседей.




Ключевые понятия
----------------

### Пространство состоит из клеток, сайтов и атомов.

**Клетка** - минимальная единица пространства в форме куба, в которой может
находиться только один атом. Размер ребра клетки равен [<b style="color:red">l</b>](#nl). Клетка занимает строгое положение в пространстве и имеет 26 соседей. Клетка определяется
уникальным индексом, список соседей — это индексы. Массив клеток хранится в виде
массива [*x*, *y*, *z*], где *x*, *y* и *z* - левые нижние координаты клетки,
делённые на [<b style="color:red">l</b>](#nl).

**Атом** - единица материала, которая характеризуется атомным номером, энергией,
списком доступных превращений. Принадлежность атома к клетке определяется левым
нижним углом. Атом не может иметь соседей в одной клетке.

**Конгломерат атомов** - группа атомов (не менее 2), которые составляют
кристаллическую решётку. Конгломерат характеризуется углом между определённым
направлением кристаллической решёткой к оси oY и оси oZ. Конгломерат атомов
определяет положение сайтов.

**Сайт** - возможное положение атома определённого типа в пространстве. Сайт
определяется исходя из конфигураций атомов. Для конфигурации атомов определяются
сайты в пространстве для каждого типа атомов. Сайт имеет три состояния:
недоступен, свободен и занят.

-   "Свободен" определяет состояние сайта, в котором возможно расположение атома
    и при этом сайт пустой.

-   "Занят" определяет состояние сайта, в котором возможно расположение атома и
    при этом сайт занят атомом.

-   "Недоступен" определяет состояние сайта, в котором невозможно расположение
    атома и при этом сайт пустой.

Принадлежность сайта к клетки определяется исходя из координат сайта с
округлением в меньшую сторону и делённым на **Round(x)**/[<b style="color:red">l</b>](#nl),
**Round(y)**/[<b style="color:red">l</b>](#nl), **Round(z)**/[<b style="color:red">l</b>](#nl). Сайт характеризуется энергией активации,
которая рассчитывается по энергиям взаимодействия атомов в соседних клетках, при
этом энергия пропорциональная расстоянию. Если атомы одного конгломерата, то
расстояние равно 1. Если атом принадлежит другому конгломерату, то расстояние
рассчитывается по формуле: расстояние от сайта до сайта соседнего атома,
делённого на [<b style="color:red">l</b>](#nl).

### Определение сайтов конгломерата атомов

Для определения сайтов конгломерата атомов определяется сначала направление
кристаллической решётки в пространстве, считается угол между направлением и осью
*oX* и *oY*, и исходя из заданных параметров считаются положения, куда могут
прикрепиться другие атомы. Эти положения и есть сайты. В одном квадрате может
содержаться только один сайт определённого конгломерата атомов!

При присоединении атома к конгломерату (атом занимает один из возможных сайтов),
занятый сайт переводится в состояние "Занят", обновляется список возможных
сайтов в пространстве для указанного конгломерата. Список всех сайтов, в клетке,
соответствующего сайта, в которую сел атом, принимают статус "Недоступен".

При освобождении сайта атомом, сайт переводится в состояние "Свободен",
обновляется список возможных сайтов в пространстве. Все сайты соответствующей
клетки принимают статус "Свободен". Сайт принимает статус "Недоступен", когда
клетка сайта содержит в себе атом другого конгломерата.

### Поиск доступных сайтов, куда атом может перейти

Так как в одной клетке находится только один атом, то чтобы определить список
всех возможных сайтов, берутся все сайты указанного типа атома соседних
незанятых атомами клеток.

### Расчёт энергии диффузии атомов

Коэффициент диффузии определяется уравнением:

$$r_{d} = r_{0}\exp\left( \frac{- E}{k_{B}T} \right)$$,

где r0 – частота попыток, E – энергия активации, T – абсолютная температура.

Частота попыток принимается за постоянный множитель и для упрощения
приравнивается к 1. Энергия для диффузии рассчитывается путём сложения энергий
соседних атомов с расстоянием не больше [<b style="color:red">a</b>](#na) по формуле:

$$E = E_{s} + n_{1}E_{b} + n_{2}E_{L}$$,

где Es – энергия связи с подложкой, n1 и Eb – количество атомов с полным отрывом
связей и энергия связи, n2 и EL – количество атомов и энергия связи в случае
граничной диффузии (связи сохраняются).

### Процесс интегрирования

Интегрирование происходит путём осуществления одного перехода. Каждый переход –
это процесс адсорбции или миграции одного атома. В каждый шаг интегрирования
известны все возможные переходы, откуда с вероятностью, пропорциональной
коэффициенту диффузии осуществляется один из переходов. После осуществления
перехода, время симуляции увеличивается на величину обратную всем скоростям.

Время между двумя процессами осаждения рассчитывается как обратная величина
произведения скорости осаждения и площадью изучаемого пространства. Таймер
диффузии сбрасывается после каждого процесса осаждения. Каждый процесс перехода
увеличивает время на dt, и когда сумма всех dt будет равно или больше t, то
осуществляется процесс осаждения. Все возможные переходы группируются согласно
их энергии активации диффузии, а следовательно все они имеют одинаковый
коэффициент диффузии. Общая величина скорости определяется как сумма
произведений переходов всех классов на их коэффициент диффузии. Расчёты
останавливаются, когда система достигнет определённой высоты или количества
атомов.

### Процесс осаждения без бомбардировки при постоянной плотности ионного потока

Структура программы
===================

После первого напыления рассчитываются все рейтинги и происходит их
классификация по энергиям.

Первая итерация.

Напыляются атомы. Для каждого атома из осаждённых:

1.  Проверяется, что атом не формирует связь с другим (другими атомами):

    1.  Если в соседних клетках уже есть хоть один диммер, то рассчитываются переходы для сайтов в этих диммерах. Если димеров нет, то смотрятся атомы в соседних клетках. Проверка на диммеры возможно при наличие неоккупированных сайтов в соседних клетках. Если есть атомы, то рассчитывается между ними кратчайшее расстояние. Если оно равно или меньше [<b style="color:red">l</b>](#nl), то два атома формируют димер. Для всех атомов диммера рассчитываются сайты и переходы. Клетки принимают статус **Обновлён**.

    2.  Если в соседних клетках нет атомов, то энергия перехода равна энергии диффузии по подложке, направление перехода задается случайным вектором через угол генерированием числа от [0, 360). Клетки принимают статус **Обновлён**.

2.  Переходы сохраняются в словарь.

3.  Случайным образом берётся переход классификации j из клетки со статусом
    **Обновлён** и осуществляется этот переход. Соседние клетки старого
    положения и нового принимают статус **Требуют обновления**.

1.а Случайным образом берётся атом классификации j=1 из клетки со статусом
Обновлён и перемещается 1.б Все клетки в радиусе 2l получают статус **Требуют
обновления** в текущей итерации. То есть они не могут браться в расчёт.

1.в Клетки со статусом требуют обновления обновляют свои энергетические
параметры и принимают статус Обновлён.

2.а Берётся другой атом классификации j=2 с клеткой, со статусом **Обновлён** и
перемещается 2.б Все клетки в радиусе 2l получают статус Требуют обновления в
текущей итерации. То есть они не могут браться в расчёт. 2.в Клетки со статусом
требуют обновления обновляют свои энергетические параметры и принимают статус
Обновлён.

Операции 1.а и 2.а относятся к одной группе действий - перемещение.

\- Меняет энергетические параметры в соседних клетках. Операции 1.б и в и 2.б и
в относятся к одной группе - расчёт энергий. - Не меняет энергетические
параметры соседних клеток.

Если выполнять параллельно операции типа а, то может возникнуть конфликт.
Операция а начнёт выполняться на клетке, которая в состоянии "Требует
обновление". Этого быть не должно. Нужно либо эти операции выполнять
последовательно, в том время как операции 1.б и 1.в выполнять параллельно. Либо
как-то реализовать возможность параллельного выполнения.

Возможность параллельного. Берётся незапрещенный атом и номер ревизии его
клетки, добавляется в коллекцию атомов в обработке.

Берутся два атома. Пытаются добавить свои коллекции клеток в потокобезопасный
словарь клеток, который требуют обновления энергии.

-   если все клетки успешно добавлены, то проверяется номер ревизии клетки, с
    которой атом пришёл и текущий номер ревизии клетки -- если номер ревизии
    совпадает, то обновляется информация в соседних клетках и сам он
    перемещается. После перемещения запускается обработчик 2.б и 2.в. -- если
    номер ревизии не совпадает, то возвращается информация о его энергетическом
    классе и из этого класса берётся другой атом

-   Если запрещён, то возвращается информация о его энергетическом классе, и из
    этого класса берётся другой атом



При выполненнии операции 2.б и 2.в рассчитываются энергии и у клеток
увеличивается номер ревизии.

Визуально представление будет осуществляться посредством обращение к базе
данных. Структура базы данных: MongoDB

Доступ к атомам и сайтам. Есть рабочее поле. Клетки используются для уменьшения
времени поиска. Поэтому доступ к сайтам и атомам осуществляется посредством
поиска

## Формирование диммера
При связывании двух атомов, происходит формирование диммера. Диммер характеризуется положением в пространстве, которое определяется направляющим вектором между двумя атомами заданного типа (Направление кристаллической решётки). У каждой кристаллической решётки есть свой базовый (не из кристаллографии) вектор, (например для ГЦК примем ([<b style="color:red">l</b>](#nl) 0 0)), который характеризуется заданной длинной. Относительно этого вектора указываются трансляции, после чего программа рассчитывает углы поворота относительно базового вектора и длину в глобальных координатах. При связывании двух атомов:
1. Определяется кристаллографическое направление;
2. Это кристаллографическое направление сравнивается с базовым вектором и в случае отклонения, считается угол поворота.
3. Рассчитывается вектор в глобальных координатах, и затем поворачивается на расчитанный угол. В итоге мы получаем базовый вектор в глобальных координатах.
4. Рассчитываются трансляции путём поворота базового вектора в ГК на заданный угол, а также умножение на коэффициент длины. 

## Правило поиска сайтов

Сайты ищётся для димеров.  
У каждого ГЦК диммера есть две оси, характеризующие направление оси атомов одного типа и направление оси атомов двух типов. Для каждого атома на поверхности диммера сайты могут быть только в определённых клетках.   
Для каждого поверхностного атома считаются сайты.  
Список возможных сайтов фильтруется, чтобы исключить сайты:
1. С количеством связей меньше 3  
Атом определяется точкой в пространстве с известными координатами. От этой точки откладывается 6 векторов одной длинны с разными знаками. Рассчитывается шесть точек - это и есть спрайты.

Клетки для ГЦК:  
x y z  
-1 -1 0   
1 1 0  
-1 1 0  
1 1 0  
0 0 -1  
0 0 1  





### Конфигурации бимеров  

При формировании связи определяется тип кристаллографического направления и рассчитывается этот вектор.



#### Формирование связи Me-Me  
Базовый вектор: [1 0 0]
Координаты трёх атомов.
Формируемое кристаллографическое направление: [1 0 0]  
##### Диффузия атома Me  
Алгоритм поиска сайта:
1. Нахождение плоскости **P(Px, Py, Pz)**, в которой лежат все три атома.
2. Находим нормаль **n** к этой плоскости. 
3. Находим плоскость P`(Px, Py, Pz), в которой лежат базовый вектор, нормаль **n** и один из атомов.
4. Находим нормаль к n` к этой плоскости. Эта нормаль и есть направляющий вектор **v**, который отвечает кристаллографическому направлению группы {0 0 1}, куда и должен сесть атом.
5. Из справочника находим размер этого вектора и приводим n` к длине, соответствующего размера.
6. Начинаем поиск возможного сайта:
Итерация заключается в последовательном повороте вектора **v** вокруг базового вектора с заданным шагом. Поворот одновременно в две стороны.
    6.1 Итерация до тех пор, пока расстояние от итерируемого сайта до атома меньше [<b>a</b>](#na).
    6.2 Итерация обрывается положительно, когда выполняется два условия:
        6.2.1 Ячейка, в которой находится атом - неоккупированная. 
        6.2.2 В соседней клетки есть атом (димерный либо подложка и расстояние до него больше, чем l и меньше, чем a.
7. Если удалось найти сайт, то мы осуществляем этот процесс диффузии безусловно (для экономии ресурсов). И формируем диммер, с тремя базисными векторами.
В случае отрицательного исхода, атом просто диффундирует в другое направление.
##### Диффузия атома N
Алгоритм поиска сайта:
1. Нахождение плоскости **P(Px, Py, Pz)**, в которой лежат все три атома.
2. Находим нормаль **n** к этой плоскости. 
3. Поворачиваем базовый вектор вокруг **n** на угол, равный углу между крист. направлением [1 0 0] и [1 1 0]
4. Полученный путём поворота вектор **v** и есть вектор, отвечающий крист. группе направлений {1 1 0}
5. Из справочника находим размер этого вектора и приводим к длине, соответствующего размера.
6. Начинаем поиск возможного сайта:
Итерация заключается в последовательном повороте вектора **v** вокруг базового вектора с заданным шагом. Поворот одновременно в две стороны.
    6.1 Итерация до тех пор, пока расстояние от итерируемого сайта до атома меньше [<b>a</b>](#na).
    6.2 Итерация обрывается положительно, когда выполняется два условия:
        6.2.1 Ячейка, в которой находится атом - неоккупированная. 
        6.2.2 В соседней клетки есть атом (димерный либо подложка и расстояние до него больше, чем l и меньше, чем a.
7. Если удалось найти сайт, то мы осуществляем этот процесс диффузии безусловно (для экономии ресурсов). И формируем диммер, с тремя базисными векторами.
В случае отрицательного исхода, атом просто диффундирует в другое направление.

#### Формирование связи Me-N  
Базовый вектор: [1 1 0]
Координаты трёх атомов.
##### Диффузия атома Me  
Алгоритм поиска сайта:
1. Нахождение плоскости **P(Px, Py, Pz)**, в которой лежат все три атома.
2. Находим нормаль **n** к этой плоскости. 
3. Поворачиваем базовый вектор относительно вектора нормали **n** на угол, равный углу между [1 0 0] и [1 1 0].
4. Полученный путём поворота вектор **v** и есть вектор, отвечающий крист. группе направлений {1 0 0}
5. Из справочника находим размер этого вектора и приводим n` к длине, соответствующего размера.
6. Начинаем поиск возможного сайта:
Итерация заключается в последовательном повороте вектора **v** вокруг базового вектора с заданным шагом. Поворот одновременно в две стороны.
    6.1 Итерация до тех пор, пока расстояние от итерируемого сайта до атома меньше [<b>a</b>](#na).
    6.2 Итерация обрывается положительно, когда выполняется два условия:
        6.2.1 Ячейка, в которой находится атом - неоккупированная. 
        6.2.2 В соседней клетки есть атом (димерный либо подложка и расстояние до него больше, чем l и меньше, чем a.
7. Если удалось найти сайт, то мы осуществляем этот процесс диффузии безусловно (для экономии ресурсов). И формируем диммер, с тремя базисными векторами.
В случае отрицательного исхода, атом просто диффундирует в другое направление.

##### Диффузия атома N  
Алгоритм поиска сайта:
1. Нахождение плоскости **P(Px, Py, Pz)**, в которой лежат все три атома.
2. Находим нормаль **n** к этой плоскости. 
3. Поворачиваем базовый вектор относительно вектора нормали **n** на угол, равный углу между [1 0 1] и [1 1 0].
4. Полученный путём поворота вектор **v** и есть вектор, отвечающий крист. группе направлений {1 1 0}
5. Начинаем поиск возможного сайта:
6. Из справочника находим размер этого вектора и приводим n` к длине, соответствующего размера.
Итерация заключается в последовательном повороте вектора **v** вокруг базового вектора с заданным шагом. Поворот одновременно в две стороны.
6.1 Итерация до тех пор, пока расстояние от итерируемого сайта до атома меньше [<b>a</b>](#na).
6.2 Итерация обрывается положительно, когда выполняется два условия:
6.2.1 Ячейка, в которой находится атом - неоккупированная. 
6.2.2 В соседней клетки есть атом (димерный либо подложка и расстояние до него больше, чем [<b style="color:red">l</b>](nl) и меньше, чем [<b style="color:red">a</b>](na).
. Если удалось найти сайт, то мы осуществляем этот процесс диффузии безусловно (для экономии ресурсов). И формируем диммер, с тремя базисными векторами.
В случае отрицательного исхода, атом просто диффундирует в другое направление.

# Номенклатура

<a id="nl">l - минимальная единица пространства, равная одной третьей от [<label>a<label>](#na)</a>;    
<a id="na">a - Кристаллографический параметр решётки</a>;  
